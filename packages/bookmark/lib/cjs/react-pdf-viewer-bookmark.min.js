"use strict";var e=require("react/jsx-runtime"),t=require("@react-pdf-viewer/core");function r(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var o=r(require("react")),n=function(){return e.jsx(t.Icon,{size:16,children:e.jsx("path",{d:"M6.427,8.245A.5.5,0,0,1,6.862,7.5H17.138a.5.5,0,0,1,.435.749l-5.139,9a.5.5,0,0,1-.868,0Z"})})},a=function(){return e.jsx(t.Icon,{size:16,children:e.jsx("path",{d:"M9.248,17.572a.5.5,0,0,1-.748-.434V6.862a.5.5,0,0,1,.748-.434l8.992,5.138a.5.5,0,0,1,0,.868Z"})})},i=function(){return i=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var s,c=function(r){var s=r.bookmark,c=r.depth,u=r.doc,l=r.index,m=r.isBookmarkExpanded,k=r.numberOfSiblings,p=r.pathFromRoot,f=r.renderBookmarkItem,b=r.store,v=p?"".concat(p,".").concat(l):"".concat(l),x=o.useMemo((function(){return function(e){var t=e.count,r=e.items;if(t>=0)return!1;var o=r.length;if(0===o)return!1;for(var n=r.concat([]);n.length>0;){var a=n.shift(),i=a.items;a.count&&i&&a.count>0&&i.length>0&&(o+=i.length,n=n.concat(i))}return Math.abs(t)===o}(s)}),[s]),h=b.get("bookmarkExpandedMap"),g=m?m({bookmark:s,doc:u,depth:c,index:l}):h.has(v)?h.get(v):!x,_=o.useState(g),j=_[0],E=_[1],B=s.items&&s.items.length>0,I=function(){var e=!j;b.updateCurrentValue("bookmarkExpandedMap",(function(t){return t.set(v,e)})),E(e)},y=function(){var e=s.dest,r=b.get("jumpToDestination");t.getDestination(u,e).then((function(e){r&&r(i({label:s.title},e))}))},w=function(){B&&s.dest&&y()},C=function(){!B&&s.dest&&y()},D=function(t,r){return e.jsx("div",{className:"rpv-bookmark__item",style:{paddingLeft:"".concat(1.25*c,"rem")},onClick:t,children:r})},N=function(t,r){return B?e.jsx("span",{className:"rpv-bookmark__toggle","data-testid":"bookmark__toggle-".concat(c,"-").concat(l),onClick:I,children:j?t:r}):e.jsx("span",{className:"rpv-bookmark__toggle"})},R=function(t){return s.url?e.jsx("a",{className:"rpv-bookmark__title",href:s.url,rel:"noopener noreferrer nofollow",target:s.newWindow?"_blank":"",children:s.title}):e.jsx("div",{className:"rpv-bookmark__title","aria-label":s.title,onClick:t,children:s.title})};return e.jsxs("li",{"aria-expanded":j?"true":"false","aria-label":s.title,"aria-level":c+1,"aria-posinset":l+1,"aria-setsize":k,role:"treeitem",tabIndex:-1,children:[f?f({bookmark:s,depth:c,hasSubItems:B,index:l,isExpanded:j,path:v,defaultRenderItem:D,defaultRenderTitle:R,defaultRenderToggle:N,onClickItem:C,onClickTitle:w,onToggleSubItems:I}):D(C,e.jsxs(e.Fragment,{children:[N(e.jsx(n,{}),e.jsx(a,{})),R(w)]})),B&&j&&e.jsx(d,{bookmarks:s.items,depth:c+1,doc:u,isBookmarkExpanded:m,isRoot:!1,pathFromRoot:v,renderBookmarkItem:f,store:b})]})},d=function(t){var r=t.bookmarks,o=t.depth,n=void 0===o?0:o,a=t.doc,i=t.isBookmarkExpanded,s=t.isRoot,d=t.pathFromRoot,u=t.renderBookmarkItem,l=t.store;return e.jsx("ul",{className:"rpv-bookmark__list",role:s?"tree":"group",tabIndex:-1,children:r.map((function(t,o){return e.jsx(c,{bookmark:t,depth:n,doc:a,index:o,isBookmarkExpanded:i,numberOfSiblings:r.length,pathFromRoot:d,renderBookmarkItem:u,store:l},o)}))})};!function(e){e[e.Collapse=0]="Collapse",e[e.Expand=1]="Expand"}(s||(s={}));var u=function(t){var r=t.bookmarks,n=t.doc,a=t.isBookmarkExpanded,i=t.renderBookmarkItem,c=t.store,u=o.useRef(),l=function(e){var t=u.current;if(t&&e.target instanceof HTMLElement&&t.contains(e.target))switch(e.key){case"ArrowDown":e.preventDefault(),k((function(e,t){return e.indexOf(t)+1}));break;case"ArrowLeft":e.preventDefault(),p(s.Collapse);break;case"ArrowRight":e.preventDefault(),p(s.Expand);break;case"ArrowUp":e.preventDefault,k((function(e,t){return e.indexOf(t)-1}));break;case"End":e.preventDefault(),k((function(e,t){return e.length-1}));break;case" ":case"Enter":case"Space":e.preventDefault(),m();break;case"Home":e.preventDefault(),k((function(e,t){return 0}))}},m=function(){var e=document.activeElement.closest(".rpv-bookmark__item").querySelector(".rpv-bookmark__title");e&&e.click()},k=function(e){var t=u.current,r=[].slice.call(t.getElementsByClassName("rpv-bookmark__item"));if(0!==r.length){var o=document.activeElement,n=r[Math.min(r.length-1,Math.max(0,e(r,o)))];o.setAttribute("tabindex","-1"),n.setAttribute("tabindex","0"),n.focus()}},p=function(e){var t=u.current;if(0!==[].slice.call(t.getElementsByClassName("rpv-bookmark__item")).length){var r=document.activeElement.closest(".rpv-bookmark__item"),o=e===s.Collapse?"true":"false";if(r&&r.parentElement.getAttribute("aria-expanded")===o){var n=r.querySelector(".rpv-bookmark__toggle");n&&n.click()}}};return o.useEffect((function(){return document.addEventListener("keydown",l),function(){document.removeEventListener("keydown",l)}}),[]),o.useEffect((function(){var e=u.current;if(e){var t=[].slice.call(e.getElementsByClassName("rpv-bookmark__item"));t.length>0&&(t[0].focus(),t[0].setAttribute("tabindex","0"))}}),[]),e.jsx("div",{ref:u,children:e.jsx(d,{bookmarks:r,depth:0,doc:n,isBookmarkExpanded:a,isRoot:!0,pathFromRoot:"",renderBookmarkItem:i,store:c})})},l=function(r){var n=r.doc,a=r.isBookmarkExpanded,i=r.renderBookmarkItem,s=r.store,c=o.useContext(t.LocalizationContext).l10n,d=o.useContext(t.ThemeContext).direction===t.TextDirection.RightToLeft,l=o.useState({isLoaded:!1,items:[]}),m=l[0],k=l[1];return o.useEffect((function(){k({isLoaded:!1,items:[]}),n.getOutline().then((function(e){k({isLoaded:!0,items:e||[]})}))}),[n]),m.isLoaded?0===m.items.length?e.jsx("div",{"data-testid":"bookmark__empty",className:t.classNames({"rpv-bookmark__empty":!0,"rpv-bookmark__empty--rtl":d}),children:c&&c.bookmark?c.bookmark.noBookmark:"There is no bookmark"}):e.jsx("div",{"data-testid":"bookmark__container",className:t.classNames({"rpv-bookmark__container":!0,"rpv-bookmark__container--rtl":d}),children:e.jsx(u,{bookmarks:m.items,doc:n,isBookmarkExpanded:a,renderBookmarkItem:i,store:s})}):e.jsx("div",{className:"rpv-bookmark__loader",children:e.jsx(t.Spinner,{})})},m=function(r){var n=r.isBookmarkExpanded,a=r.renderBookmarkItem,i=r.store,s=o.useState(i.get("doc")),c=s[0],d=s[1],u=function(e){d(e)};return o.useEffect((function(){return i.subscribe("doc",u),function(){i.unsubscribe("doc",u)}}),[]),c?e.jsx(l,{doc:c,isBookmarkExpanded:n,renderBookmarkItem:a,store:i}):e.jsx("div",{className:"rpv-bookmark__loader",children:e.jsx(t.Spinner,{})})};exports.DownArrowIcon=n,exports.RightArrowIcon=a,exports.bookmarkPlugin=function(){var r=o.useMemo((function(){return t.createStore({bookmarkExpandedMap:new Map})}),[]);return{install:function(e){r.update("jumpToDestination",e.jumpToDestination)},onDocumentLoad:function(e){r.update("doc",e.doc)},Bookmarks:function(t){return e.jsx(m,{isBookmarkExpanded:null==t?void 0:t.isBookmarkExpanded,renderBookmarkItem:null==t?void 0:t.renderBookmarkItem,store:r})}}};
