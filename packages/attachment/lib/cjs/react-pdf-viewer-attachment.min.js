"use strict";var t=require("react/jsx-runtime"),e=require("@react-pdf-viewer/core");function n(t){var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var a=n(require("react")),r=function(n){var r=n.files,c=a.useRef(),i=a.useContext(e.LocalizationContext).l10n,o=a.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,u=a.useRef([]),s=i&&i.attachment?i.attachment.clickToDownload:"Click to download",l=function(t){var e=c.current,n=[].slice.call(e.getElementsByClassName("rpv-attachment__item"));if(0!==n.length){n.forEach((function(t){return t.setAttribute("tabindex","-1")}));var a=document.activeElement,r=n[Math.min(n.length-1,Math.max(0,t(n,a)))];r.setAttribute("tabindex","0"),r.focus()}};return e.useIsomorphicLayoutEffect((function(){var t=c.current;if(t){var e=[].slice.call(t.getElementsByClassName("rpv-attachment__item"));if(u.current=e,e.length>0){var n=e[0];n.focus(),n.setAttribute("tabindex","0")}}}),[]),t.jsx("div",{"data-testid":"attachment__list",className:e.classNames({"rpv-attachment__list":!0,"rpv-attachment__list--rtl":o}),ref:c,tabIndex:-1,onKeyDown:function(t){switch(t.key){case"ArrowDown":t.preventDefault(),l((function(t,e){return t.indexOf(e)+1}));break;case"ArrowUp":t.preventDefault(),l((function(t,e){return t.indexOf(e)-1}));break;case"End":t.preventDefault(),l((function(t,e){return t.length-1}));break;case"Home":t.preventDefault(),l((function(t,e){return 0}))}},children:r.map((function(e){return t.jsx("button",{className:"rpv-attachment__item",tabIndex:-1,title:s,type:"button",onClick:function(){return t=e.fileName,n=e.data,a="string"==typeof n?"":URL.createObjectURL(new Blob([n],{type:""})),(r=document.createElement("a")).style.display="none",r.href=a||t,r.setAttribute("download",function(t){var e=t.split("/").pop();return e?e.split("#")[0].split("?")[0]:t}(t)),document.body.appendChild(r),r.click(),document.body.removeChild(r),void(a&&URL.revokeObjectURL(a));var t,n,a,r},children:e.fileName},e.fileName)}))})},c=function(n){var c=n.doc,i=a.useContext(e.LocalizationContext).l10n,o=a.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,u=i&&i.attachment?i.attachment.noAttachment:"There is no attachment",s=a.useState({files:[],isLoaded:!1}),l=s[0],f=s[1];return a.useEffect((function(){c.getAttachments().then((function(t){var e=t?Object.keys(t).map((function(e){return{data:t[e].content,fileName:t[e].filename}})):[];f({files:e,isLoaded:!0})}))}),[c]),l.isLoaded?0===l.files.length?t.jsx("div",{"data-testid":"attachment__empty",className:e.classNames({"rpv-attachment__empty":!0,"rpv-attachment__empty--rtl":o}),children:u}):t.jsx(r,{files:l.files}):t.jsx(e.Spinner,{})},i=function(n){var r=n.store,i=a.useState(r.get("doc")),o=i[0],u=i[1],s=function(t){u(t)};return a.useEffect((function(){return r.subscribe("doc",s),function(){r.unsubscribe("doc",s)}}),[]),o?t.jsx(c,{doc:o}):t.jsx("div",{className:"rpv-attachment__loader",children:t.jsx(e.Spinner,{})})};exports.attachmentPlugin=function(){var n=a.useMemo((function(){return e.createStore({})}),[]);return{onDocumentLoad:function(t){n.update("doc",t.doc)},Attachments:function(){return t.jsx(i,{store:n})}}};
