"use strict";var e=require("react/jsx-runtime"),t=require("@react-pdf-viewer/core");function r(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var n=r(require("react")),o=function(){return e.jsx(t.Icon,{size:16,children:e.jsx("path",{d:"M0.541,5.627L11.666,18.2c0.183,0.207,0.499,0.226,0.706,0.043c0.015-0.014,0.03-0.028,0.043-0.043\n            L23.541,5.627"})})},a=function(){return e.jsx(t.Icon,{size:16,children:e.jsx("path",{d:"M23.535,18.373L12.409,5.8c-0.183-0.207-0.499-0.226-0.706-0.043C11.688,5.77,11.674,5.785,11.66,5.8\n            L0.535,18.373"})})},c=function(){return e.jsx(t.Icon,{ignoreDirection:!0,size:16,children:e.jsx("path",{d:"M10.5,0.5c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.5,10.5,0.5z\n            M23.5,23.5\n            l-5.929-5.929"})})},s=function(){return s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var i=function(e){return{left:"".concat(e.left,"%"),top:"".concat(e.top,"%"),height:"".concat(e.height,"%"),width:"".concat(e.width,"%")}},u=function(r){var o=r.index,a=r.area,c=r.onHighlightKeyword,s=n.useRef();return t.useIsomorphicLayoutEffect((function(){var e=s.current;c&&e&&c({highlightEle:e,keyword:a.keyword})}),[]),e.jsx("div",{className:"rpv-search__highlight","data-index":o,ref:s,style:i(a),title:a.keywordStr.trim()})},l={keyword:"",regExp:new RegExp(" "),wholeWords:!1},h=function(e){var t=e.parentNode;t&&t.removeChild(e)},d=function(e){var t=e.parentNode;if(t){var r=document.createRange();r.selectNodeContents(e),function(e,t){h(e);var r=t.parentNode;r&&r.insertBefore(e,t),h(t)}(r.extractContents(),e),t.normalize()}},f=function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.left<t.left?-1:e.left>t.left?1:0},p=function(r){var o=r.numPages,a=r.pageIndex,c=r.renderHighlights,s=r.store,h=r.onHighlightKeyword,p=n.useRef(),g=n.useCallback((function(t){return e.jsx(e.Fragment,{children:t.highlightAreas.map((function(t,r){return e.jsx(u,{index:r,area:t,onHighlightKeyword:h},r)}))})}),[]),x=c||g,v=n.useState(s.get("matchPosition")),m=v[0],y=v[1],w=n.useState(s.get("keyword")||[l]),b=w[0],j=w[1],k=n.useState({pageIndex:a,scale:1,status:t.LayerRenderStatus.PreRender}),S=k[0],C=k[1],P=n.useRef(null),_=n.useRef([]),I=n.useState([]),E=I[0],T=I[1],M=function(){return!0},R=n.useCallback((function(){return s.get("targetPageFilter")||M}),[s.get("targetPageFilter")]),L=function(e){var t=_.current;if(0===t.length)return[];var r=[],n=[].slice.call(e.querySelectorAll(".rpv-core__text-layer-text")),c=t.map((function(e){return e.char})).join("");return b.forEach((function(s){var i=s.keyword;if(i.trim()){for(var u,l=-1===s.regExp.flags.indexOf("g")?new RegExp(s.regExp,"".concat(s.regExp.flags,"g")):s.regExp,h=[];null!==(u=l.exec(c));)h.push({keyword:l,startIndex:u.index,endIndex:l.lastIndex});h.map((function(e){return{keyword:e.keyword,indexes:t.slice(e.startIndex,e.endIndex)}})).forEach((function(t){var c=t.indexes.reduce((function(e,t){return e[t.spanIndex]=(e[t.spanIndex]||[]).concat([t]),e}),{});Object.values(c).forEach((function(c){if(1!==c.length||""!==c[0].char.trim()){var u=s.wholeWords?c.slice(1,-1):c,l=function(e,t,r,n,c){var s=document.createRange(),i=n.firstChild;if(!i||i.nodeType!==Node.TEXT_NODE)return null;var u=i.textContent.length,l=c[0].charIndexInSpan,h=1===c.length?l:c[c.length-1].charIndexInSpan;if(l>u||h+1>u)return null;s.setStart(i,l),s.setEnd(i,h+1);var f=document.createElement("span");s.surroundContents(f);var p=f.getBoundingClientRect(),g=r.getBoundingClientRect(),x=g.height,v=g.width,m=100*(p.left-g.left)/v,y=100*(p.top-g.top)/x,w=100*p.height/x,b=100*p.width/v;return d(f),{keyword:t,keywordStr:e,numPages:o,pageIndex:a,left:m,top:y,height:w,width:b,pageHeight:x,pageWidth:v}}(i,t.keyword,e,n[u[0].spanIndex],u);l&&r.push(l)}}))}))}})),r.sort(f)},N=function(e){e&&e.length>0&&j(e)},K=function(e){return y(e)},O=function(e){if(e.has(a)){var t=e.get(a);t&&C({ele:t.ele,pageIndex:a,scale:t.scale,status:t.status})}},W=function(){return 0===b.length||1===b.length&&""===b[0].keyword.trim()};return n.useEffect((function(){if(!W()&&S.status===t.LayerRenderStatus.DidRender&&!_.current.length){var e=S.ele,r=[].slice.call(e.querySelectorAll(".rpv-core__text-layer-text")).map((function(e){return e.textContent})).reduce((function(e,t,r){return e.concat(t.split("").map((function(e,t){return{char:e,charIndexInSpan:t,spanIndex:r}})))}),[{char:"",charIndexInSpan:0,spanIndex:0}]).slice(1);_.current=r}}),[b,S.status]),n.useEffect((function(){if(!W()&&S.ele&&S.status===t.LayerRenderStatus.DidRender&&R()({pageIndex:a,numPages:o})){var e=S.ele,r=L(e);T(r)}}),[b,m,S.status,_.current]),n.useEffect((function(){W()&&S.ele&&S.status===t.LayerRenderStatus.DidRender&&T([])}),[b,S.status]),n.useEffect((function(){if(0!==E.length){var e=p.current;if(m.pageIndex===a&&e&&S.status===t.LayerRenderStatus.DidRender){var r=e.querySelector('.rpv-search__highlight[data-index="'.concat(m.matchIndex,'"]'));if(r){var n=function(e,t){for(var r=e.offsetTop,n=e.offsetLeft,o=e.parentElement;o&&o!==t;)r+=o.offsetTop,n+=o.offsetLeft,o=o.parentElement;return{left:n,top:r}}(r,e),o=n.left,c=n.top,i=s.get("jumpToDestination");i&&(i({pageIndex:a,bottomOffset:(e.getBoundingClientRect().height-c)/S.scale,leftOffset:o/S.scale,scaleTo:S.scale}),P.current&&P.current.classList.remove("rpv-search__highlight--current"),P.current=r,r.classList.add("rpv-search__highlight--current"))}}}}),[E,m]),n.useEffect((function(){return s.subscribe("keyword",N),s.subscribe("matchPosition",K),s.subscribe("renderStatus",O),function(){s.unsubscribe("keyword",N),s.unsubscribe("matchPosition",K),s.unsubscribe("renderStatus",O)}}),[]),e.jsx("div",{className:"rpv-search__highlights","data-testid":"search__highlights-".concat(a),ref:p,children:x({getCssProperties:i,highlightAreas:E})})},g=function(e){var t,r=e.wholeWords?" ".concat(e.keyword," "):e.keyword,n=e.matchCase?"g":"gi";return{keyword:e.keyword,regExp:new RegExp((t=r,t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),n),wholeWords:e.wholeWords||!1}},x=function(e,t,r){return e instanceof RegExp?{keyword:e.source,regExp:e,wholeWords:r||!1}:"string"==typeof e?""===e?l:g({keyword:e,matchCase:t||!1,wholeWords:r||!1}):(void 0!==t&&(e.matchCase=t),void 0!==r&&(e.wholeWords=r),g(e))},v=function(e){var r,o=e.get("initialKeyword"),a=n.useMemo((function(){if(o&&1===o.length){var e=x(o[0]);return{matchCase:-1===e.regExp.flags.indexOf("i"),wholeWords:e.wholeWords}}return{matchCase:!1,wholeWords:!1}}),[]),c=function(e){var t=n.useRef(e.get("doc")),r=function(e){t.current=e};return n.useEffect((function(){return e.subscribe("doc",r),function(){e.unsubscribe("doc",r)}}),[]),t}(e),s=n.useState(o),i=s[0],u=s[1],h=n.useState([]),d=h[0],f=h[1],p=n.useState(0),g=p[0],v=p[1],m=n.useState(a.matchCase),y=m[0],w=m[1],b=n.useRef([]),j=n.useState(a.wholeWords),k=j[0],S=j[1],C=function(){return!0},P=n.useCallback((function(){return e.get("targetPageFilter")||C}),[e.get("targetPageFilter")]),_=function(e){var t=d.length;if(0===i.length||0===t)return null;var r=e===t+1?1:Math.max(1,Math.min(t,e));return v(r),E(d[r-1])},I=function(e){return u(""===e?[]:[e])},E=function(t){var r=e.get("jumpToPage");return r&&r(t.pageIndex),e.update("matchPosition",{matchIndex:t.matchIndex,pageIndex:t.pageIndex}),t},T=function(r,n,o){var a=c.current;if(!a)return Promise.resolve([]);var s=a.numPages,i=r.map((function(e){return x(e,n,o)}));return e.update("keyword",i),v(0),f([]),new Promise((function(e,r){var n=0===b.current.length?function(){var e=c.current;if(!e)return Promise.resolve([]);var r=Array(e.numPages).fill(0).map((function(r,n){return t.getPage(e,n).then((function(e){return e.getTextContent()})).then((function(e){var t=e.items.map((function(e){return e.str||""})).join("");return Promise.resolve({pageContent:t,pageIndex:n})}))}));return Promise.all(r).then((function(e){return e.sort((function(e,t){return e.pageIndex-t.pageIndex})),Promise.resolve(e.map((function(e){return e.pageContent})))}))}().then((function(e){return b.current=e,Promise.resolve(e)})):Promise.resolve(b.current);n.then((function(t){var r=[];t.forEach((function(e,t){P()({pageIndex:t,numPages:s})&&i.forEach((function(n){for(var o,a=0;null!==(o=n.regExp.exec(e));)r.push({keyword:n.regExp,matchIndex:a,pageIndex:t,pageText:e,startIndex:o.index,endIndex:n.regExp.lastIndex}),a++}))})),f(r),r.length>0&&(v(1),E(r[0])),e(r)}))}))};return n.useEffect((function(){b.current=[]}),[c.current]),{clearKeyword:function(){e.update("keyword",[l]),I(""),v(0),f([]),w(!1),S(!1)},changeMatchCase:function(e){w(e),i.length>0&&T(i,e,k)},changeWholeWords:function(e){S(e),i.length>0&&T(i,y,e)},currentMatch:g,jumpToMatch:_,jumpToNextMatch:function(){return _(g+1)},jumpToPreviousMatch:function(){return _(g-1)},keywords:i,matchCase:y,numberOfMatches:d.length,wholeWords:k,search:function(){return T(i,y,k)},searchFor:T,setKeywords:u,keyword:0===i.length?"":(r=i[0],r instanceof RegExp?r.source:"string"==typeof r?r:r.keyword),setKeyword:I,setTargetPages:function(t){e.update("targetPageFilter",t)}}},m=function(e){var t=e.children,r=e.store,o=v(r),a=n.useState(!1),c=a[0],i=a[1],u=function(e){return i(!0)};return n.useEffect((function(){return r.subscribe("doc",u),function(){r.unsubscribe("doc",u)}}),[]),t(s(s({},o),{isDocumentLoaded:c}))},y=function(r){var o=r.containerRef,a=r.store,c=n.useRef(!1),s=function(){c.current=!0},i=function(){c.current=!1},u=function(e){var r=o.current;r&&(e.shiftKey||e.altKey||"f"!==e.key||(t.isMac()?e.metaKey&&!e.ctrlKey:e.ctrlKey)&&(c.current||document.activeElement&&r.contains(document.activeElement))&&(e.preventDefault(),a.update("areShortcutsPressed",!0)))};return n.useEffect((function(){var e=o.current;if(e)return document.addEventListener("keydown",u),e.addEventListener("mouseenter",s),e.addEventListener("mouseleave",i),function(){document.removeEventListener("keydown",u),e.removeEventListener("mouseenter",s),e.removeEventListener("mouseleave",i)}}),[o.current]),e.jsx(e.Fragment,{})},w={left:0,top:8},b=function(r){var c=r.store,s=r.onToggle,i=n.useContext(t.LocalizationContext).l10n,u=n.useContext(t.ThemeContext).direction,l=n.useState(!1),h=l[0],d=l[1],f=n.useState(!1),p=f[0],g=f[1],x=u===t.TextDirection.RightToLeft,m=v(c),y=m.clearKeyword,b=m.changeMatchCase,j=m.changeWholeWords,k=m.currentMatch,S=m.jumpToNextMatch,C=m.jumpToPreviousMatch,P=m.keyword,_=m.matchCase,I=m.numberOfMatches,E=m.wholeWords,T=m.search,M=m.setKeyword,R=function(e){d(!0),T().then((function(t){d(!1),g(!0),e&&e()}))};n.useEffect((function(){var e=c.get("initialKeyword");e&&1===e.length&&P&&R((function(){c.update("initialKeyword",[])}))}),[]);var L=i&&i.search?i.search.enterToSearch:"Enter to search",N=i&&i.search?i.search.previousMatch:"Previous match",K=i&&i.search?i.search.nextMatch:"Next match",O=i&&i.search?i.search.close:"Close";return e.jsxs("div",{className:"rpv-search__popover",children:[e.jsxs("div",{className:"rpv-search__popover-input-counter",children:[e.jsx(t.TextBox,{ariaLabel:L,autoFocus:!0,placeholder:L,type:"text",value:P,onChange:function(e){g(!1),M(e)},onKeyDown:function(e){"Enter"===e.key&&P&&(p?S():R())}}),e.jsxs("div",{className:t.classNames({"rpv-search__popover-counter":!0,"rpv-search__popover-counter--ltr":!x,"rpv-search__popover-counter--rtl":x}),children:[h&&e.jsx(t.Spinner,{testId:"search__popover-searching",size:"1rem"}),!h&&e.jsxs("span",{"data-testid":"search__popover-num-matches",children:[k,"/",I]})]})]}),e.jsxs("label",{className:"rpv-search__popover-label",children:[e.jsx("input",{className:"rpv-search__popover-label-checkbox","data-testid":"search__popover-match-case",checked:_,type:"checkbox",onChange:function(e){g(!1),b(e.target.checked)}})," ",i&&i.search?i.search.matchCase:"Match case"]}),e.jsxs("label",{className:"rpv-search__popover-label",children:[e.jsx("input",{className:"rpv-search__popover-label-checkbox",checked:E,"data-testid":"search__popover-whole-words",type:"checkbox",onChange:function(e){g(!1),j(e.target.checked)}})," ",i&&i.search?i.search.wholeWords:"Whole words"]}),e.jsxs("div",{className:"rpv-search__popover-footer",children:[e.jsx("div",{className:"rpv-search__popover-footer-item",children:e.jsx(t.Tooltip,{ariaControlsSuffix:"search-previous-match",position:x?t.Position.BottomRight:t.Position.BottomCenter,target:e.jsx(t.MinimalButton,{ariaLabel:N,isDisabled:k<=1,onClick:C,children:e.jsx(a,{})}),content:function(){return N},offset:w})}),e.jsx("div",{className:"rpv-search__popover-footer-item",children:e.jsx(t.Tooltip,{ariaControlsSuffix:"search-next-match",position:t.Position.BottomCenter,target:e.jsx(t.MinimalButton,{ariaLabel:K,isDisabled:k>I-1,onClick:S,children:e.jsx(o,{})}),content:function(){return K},offset:w})}),e.jsx("div",{className:t.classNames({"rpv-search__popover-footer-button":!0,"rpv-search__popover-footer-button--ltr":!x,"rpv-search__popover-footer-button--rtl":x}),children:e.jsx(t.Button,{onClick:function(){s(),y()},children:O})})]})]})},j=function(r){var o=r.children,a=r.onClick,s=n.useContext(t.LocalizationContext).l10n,i=s&&s.search?s.search.search:"Search";return o({icon:e.jsx(c,{}),label:i,onClick:a})},k={left:0,top:8},S=function(r){var o=r.enableShortcuts,a=r.store,c=r.onClick,s=o?t.isMac()?"Meta+F":"Ctrl+F":"",i=function(e){e&&c()};return n.useEffect((function(){return a.subscribe("areShortcutsPressed",i),function(){a.unsubscribe("areShortcutsPressed",i)}}),[]),e.jsx(j,{onClick:c,children:function(r){return e.jsx(t.Tooltip,{ariaControlsSuffix:"search-popover",position:t.Position.BottomCenter,target:e.jsx(t.MinimalButton,{ariaKeyShortcuts:s,ariaLabel:r.label,testId:"search__popover-button",onClick:c,children:r.icon}),content:function(){return r.label},offset:k})}})},C={left:0,top:8},P=function(r){var o=r.children,a=r.enableShortcuts,c=r.store,i=n.useContext(t.ThemeContext).direction===t.TextDirection.RightToLeft?t.Position.BottomRight:t.Position.BottomLeft,u=o||function(t){return e.jsx(S,s({enableShortcuts:a,store:c},t))};return e.jsx(t.Popover,{ariaControlsSuffix:"search",lockScroll:!1,position:i,target:function(e){return u({onClick:e})},content:function(t){return e.jsx(b,{store:c,onToggle:t})},offset:C,closeOnClickOutside:!1,closeOnEscape:!0})},_=function(e){return Array.isArray(e)?e.map((function(e){return x(e)})):[x(e)]};exports.NextIcon=o,exports.PreviousIcon=a,exports.SearchIcon=c,exports.searchPlugin=function(r){var o=n.useMemo((function(){return Object.assign({},{enableShortcuts:!0,onHighlightKeyword:function(){}},r)}),[]),a=n.useMemo((function(){return t.createStore({initialKeyword:r&&r.keyword?Array.isArray(r.keyword)?r.keyword:[r.keyword]:[],keyword:r&&r.keyword?_(r.keyword):[l],matchPosition:{matchIndex:-1,pageIndex:-1},renderStatus:new Map})}),[]),c=v(a),i=c.clearKeyword,u=c.jumpToMatch,h=c.jumpToNextMatch,d=c.jumpToPreviousMatch,f=c.searchFor,g=c.setKeywords,x=c.setTargetPages,w=function(t){return e.jsx(P,s({enableShortcuts:o.enableShortcuts},t,{store:a}))};return{install:function(e){var t=r&&r.keyword?Array.isArray(r.keyword)?r.keyword:[r.keyword]:[],n=r&&r.keyword?_(r.keyword):[l];a.update("initialKeyword",t),a.update("jumpToDestination",e.jumpToDestination),a.update("jumpToPage",e.jumpToPage),a.update("keyword",n)},renderPageLayer:function(t){return e.jsx(p,{numPages:t.doc.numPages,pageIndex:t.pageIndex,renderHighlights:null==r?void 0:r.renderHighlights,store:a,onHighlightKeyword:o.onHighlightKeyword},t.pageIndex)},renderViewer:function(t){var r=t.slot;return r.subSlot&&(r.subSlot.children=e.jsxs(e.Fragment,{children:[o.enableShortcuts&&e.jsx(y,{containerRef:t.containerRef,store:a}),r.subSlot.children]})),r},uninstall:function(e){var t=a.get("renderStatus");t&&t.clear()},onDocumentLoad:function(e){a.update("doc",e.doc)},onTextLayerRender:function(e){var t=a.get("renderStatus");t&&(t=t.set(e.pageIndex,e),a.update("renderStatus",t))},Search:function(t){return e.jsx(m,s({},t,{store:a}))},ShowSearchPopover:w,ShowSearchPopoverButton:function(){return e.jsx(w,{children:function(t){return e.jsx(S,s({enableShortcuts:o.enableShortcuts,store:a},t))}})},clearHighlights:function(){i()},highlight:function(e){var t=Array.isArray(e)?e:[e];return g(t),f(t)},jumpToMatch:u,jumpToNextMatch:h,jumpToPreviousMatch:d,setTargetPages:x}};
